<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BetPool - Season 2025/2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #F9FAFB; }
        .glass-panel { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .text-gradient-money { background-clip: text; -webkit-background-clip: text; color: transparent; background-image: linear-gradient(to right, #22C55E, #EAB308, #22C55E); }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .match-tab.active-tab { color: #F59E0B; border-bottom: 2px solid #F59E0B; }
        .match-tab { color: #9CA3AF; border-bottom: 2px solid transparent; }
        
        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #F59E0B;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .live-indicator { animation: pulse 2s infinite; }
    </style>
</head>
<body class="antialiased pb-24">

    <!-- Header -->
    <header class="bg-gray-900 p-4 fixed w-full z-50 shadow-lg border-b border-gray-800">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-extrabold text-gradient-money">BetPool Live</h1>
                <p id="season-label" class="text-[10px] text-gray-400">Season 2025/2026</p>
            </div>
            <div class="flex items-center gap-2">
                <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-500"></div>
                <span id="connection-status" class="text-xs text-gray-500">Connecting...</span>
            </div>
        </div>
    </header>

    <main class="pt-24 px-4"> 
        
        <!-- Matches Section -->
        <section id="matches-page" class="page-section active">
            
            <!-- Controls -->
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white mb-4">Live Market Feed</h2>
                
                <!-- Tabs -->
                <div class="flex justify-around mb-4 border-b border-gray-700">
                    <button id="tab-current" class="match-tab active-tab flex-1 py-3 font-bold transition-colors" onclick="switchTab('current')">Live Now</button>
                    <button id="tab-future" class="match-tab flex-1 py-3 font-bold transition-colors" onclick="switchTab('future')">Upcoming</button>
                    <button id="tab-past" class="match-tab flex-1 py-3 font-bold transition-colors" onclick="switchTab('past')">Results</button>
                </div>

                <!-- Debug Info -->
                <div id="api-debug" class="text-xs text-gray-500 font-mono mb-4 p-2 bg-gray-800 rounded hidden"></div>
            </div>

            <!-- Matches List Container -->
            <div id="matches-list" class="space-y-4 min-h-[300px]">
                <!-- Content injected by JS -->
            </div>

        </section>

    </main>

    <!-- Bottom Nav -->
    <div class="fixed bottom-0 w-full bg-gray-900 border-t border-gray-800 flex justify-around p-3 z-50">
        <button class="text-brand-gold flex flex-col items-center text-xs">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>Matches</span>
        </button>
        <button class="text-gray-500 flex flex-col items-center text-xs" onclick="alert('Profile Feature coming soon')">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span>Profile</span>
        </button>
    </div>

    <!-- Match Detail Modal -->
    <div id="match-modal" class="hidden fixed inset-0 bg-black/95 z-[60] overflow-y-auto p-4 animate-fade-in">
        <div class="bg-gray-800 rounded-xl max-w-md mx-auto mt-10 p-6 border border-gray-700 relative">
            <button onclick="document.getElementById('match-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 text-2xl">&times;</button>
            
            <div id="modal-content" class="text-center">
                <!-- Injected -->
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const API_KEY = '0324b629847195253f0d59397c5b3df4'; 
        const API_HOST = 'v3.football.api-sports.io';
        const LEAGUE_ID = 39; // Premier League
        const SEASON = 2025; 
        
        let currentTab = 'current';
        // Storage for matches
        let allMatches = { current: [], future: [], past: [] };

        // --- INITIALIZATION ---
        window.onload = function() {
            initApp();
        };

        async function initApp() {
            const list = document.getElementById('matches-list');
            list.innerHTML = '<div class="loader mt-10"></div><p class="text-center text-gray-500 mt-4 animate-pulse">Connecting to Live Data Feed...</p>';

            await fetchMatchData();
            renderMatches();
        }

        // --- API FUNCTIONS (With Fallback) ---
        async function fetchMatchData() {
            const statusEl = document.getElementById('connection-status');
            const dotEl = document.getElementById('status-dot');
            const debugEl = document.getElementById('api-debug');
            
            // API Endpoints
            const liveUrl = `https://${API_HOST}/fixtures?league=${LEAGUE_ID}&season=${SEASON}&live=all`;
            const futureUrl = `https://${API_HOST}/fixtures?league=${LEAGUE_ID}&season=${SEASON}&status=NS&next=10`;
            const pastUrl = `https://${API_HOST}/fixtures?league=${LEAGUE_ID}&season=${SEASON}&status=FT-AET-PEN&last=10`;

            const headers = {
                "x-apisports-key": API_KEY,
                "x-apisports-host": API_HOST
            };

            try {
                // Attempt to fetch all data in parallel
                const responses = await Promise.all([
                    fetch(liveUrl, { headers }),
                    fetch(futureUrl, { headers }),
                    fetch(pastUrl, { headers })
                ]);

                // Check if any request failed (e.g. 401, 403, etc.)
                if (!responses[0].ok) throw new Error("API access denied or restricted");

                const [liveJson, futureJson, pastJson] = await Promise.all(responses.map(r => r.json()));

                // Handle API-level errors (like quota exceeded)
                if (liveJson.errors && Object.keys(liveJson.errors).length > 0) {
                    throw new Error("API Error: " + JSON.stringify(liveJson.errors));
                }

                // Store Real Data
                allMatches.current = liveJson.response || [];
                allMatches.future = futureJson.response || [];
                allMatches.past = pastJson.response || [];

                // Success UI
                statusEl.innerText = "Online (API)";
                statusEl.className = "text-xs text-green-400 font-bold";
                dotEl.className = "w-2 h-2 rounded-full bg-green-500 animate-pulse";

            } catch (error) {
                // --- FALLBACK MECHANISM ---
                console.warn("API Failed, switching to Simulation Mode:", error);
                
                // Debug info for you
                debugEl.classList.remove('hidden');
                debugEl.innerHTML = `Note: Switched to Simulation Mode because the API connection was blocked by the browser (CORS). <br>Error: ${error.message}`;

                // Set UI to Simulation Mode
                statusEl.innerText = "Simulated Data (2025)";
                statusEl.className = "text-xs text-yellow-500 font-bold";
                dotEl.className = "w-2 h-2 rounded-full bg-yellow-500";

                // Generate Realistic Mock Data for 2025
                generateMockData();
            }
        }

        // --- MOCK DATA GENERATOR (2025 Teams) ---
        function generateMockData() {
            // 2025/26 Premier League likely teams
            const teams = [
                { name: "Man City", logo: "https://media.api-sports.io/football/teams/50.png" },
                { name: "Arsenal", logo: "https://media.api-sports.io/football/teams/42.png" },
                { name: "Liverpool", logo: "https://media.api-sports.io/football/teams/40.png" },
                { name: "Aston Villa", logo: "https://media.api-sports.io/football/teams/66.png" },
                { name: "Tottenham", logo: "https://media.api-sports.io/football/teams/47.png" },
                { name: "Chelsea", logo: "https://media.api-sports.io/football/teams/49.png" },
                { name: "Man Utd", logo: "https://media.api-sports.io/football/teams/33.png" },
                { name: "Newcastle", logo: "https://media.api-sports.io/football/teams/34.png" }
            ];

            // Create 3 Live Matches
            allMatches.current = [
                createMockFixture(teams[0], teams[1], "LIVE", "78'", 2, 1),
                createMockFixture(teams[6], teams[7], "LIVE", "34'", 0, 0),
                createMockFixture(teams[2], teams[3], "LIVE", "12'", 1, 0),
            ];

            // Create 4 Future Matches
            allMatches.future = [
                createMockFixture(teams[4], teams[5], "NS", "20:00", null, null),
                createMockFixture(teams[0], teams[7], "NS", "Tomorrow", null, null),
                createMockFixture(teams[1], teams[3], "NS", "Tomorrow", null, null),
                createMockFixture(teams[6], teams[2], "NS", "Sunday", null, null),
            ];

            // Create 3 Past Matches
            allMatches.past = [
                createMockFixture(teams[5], teams[2], "FT", "Finished", 2, 2),
                createMockFixture(teams[4], teams[1], "FT", "Finished", 0, 3),
                createMockFixture(teams[3], teams[6], "FT", "Finished", 1, 0),
            ];
        }

        function createMockFixture(home, away, statusShort, statusLong, goalHome, goalAway) {
            return {
                fixture: {
                    id: Math.floor(Math.random() * 100000),
                    status: { short: statusShort, elapsed: statusLong.replace("'", "") },
                    date: new Date().toISOString()
                },
                teams: { home: home, away: away },
                goals: { home: goalHome, away: goalAway },
                league: { name: "Premier League", season: 2025 }
            };
        }

        // --- RENDERING ---
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.match-tab').forEach(el => el.classList.remove('active-tab', 'text-brand-gold'));
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.classList.add('active-tab');
            
            renderMatches();
        }

        function renderMatches() {
            const container = document.getElementById('matches-list');
            container.innerHTML = ''; 
            
            const matches = allMatches[currentTab];

            if (!matches || matches.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 glass-panel rounded-xl mx-4">
                        <p class="text-gray-400 mb-2">No matches currently active.</p>
                        <p class="text-xs text-gray-600">Check 'Upcoming' or 'Results'</p>
                    </div>`;
                return;
            }

            matches.forEach(match => {
                container.appendChild(createMatchCard(match));
            });
        }

        function createMatchCard(data) {
            const f = data.fixture;
            const h = data.teams.home;
            const a = data.teams.away;
            const g = data.goals;
            
            // Random pool size for engagement
            const pool = (f.id * 934) % 5000000 + 500000;

            const div = document.createElement('div');
            div.className = 'glass-panel rounded-2xl p-4 border-t border-white/10 relative overflow-hidden transform transition-all duration-200 hover:bg-white/5';
            
            // Status Logic
            let statusBadge;
            if (currentTab === 'current') {
                statusBadge = `<div class="flex items-center gap-1 bg-red-600/90 text-white px-2 py-0.5 rounded text-[10px] font-bold">
                    <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span> LIVE ${f.status.elapsed}'
                </div>`;
            } else if (currentTab === 'future') {
                statusBadge = `<div class="bg-gray-700 text-gray-300 px-2 py-0.5 rounded text-[10px] font-bold">${f.status.elapsed || 'Scheduled'}</div>`;
            } else {
                statusBadge = `<div class="bg-gray-700 text-gray-300 px-2 py-0.5 rounded text-[10px] font-bold">FT</div>`;
            }

            div.innerHTML = `
                <!-- Header -->
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-1">
                         <img src="https://media.api-sports.io/football/leagues/${LEAGUE_ID}.png" class="w-4 h-4" onerror="this.style.display='none'">
                         <span class="text-[10px] uppercase tracking-wider text-gray-400 font-semibold">Premier League</span>
                    </div>
                    ${statusBadge}
                </div>

                <!-- Scoreboard -->
                <div class="flex justify-between items-center mb-5">
                    <div class="flex flex-col items-center w-[30%]">
                        <img src="${h.logo}" class="w-12 h-12 object-contain mb-2 drop-shadow-lg" onerror="this.src='https://media.api-sports.io/football/teams/default.png'">
                        <span class="text-xs font-bold text-center leading-tight text-white">${h.name}</span>
                    </div>

                    <div class="flex flex-col items-center justify-center w-[40%]">
                        <div class="text-3xl font-black text-white tracking-widest bg-black/30 px-4 py-1 rounded-lg">
                            ${g.home ?? '-'} : ${g.away ?? '-'}
                        </div>
                        ${currentTab === 'future' ? '<span class="text-[10px] text-brand-gold mt-1 font-bold">VS</span>' : ''}
                    </div>

                    <div class="flex flex-col items-center w-[30%]">
                        <img src="${a.logo}" class="w-12 h-12 object-contain mb-2 drop-shadow-lg" onerror="this.src='https://media.api-sports.io/football/teams/default.png'">
                        <span class="text-xs font-bold text-center leading-tight text-white">${a.name}</span>
                    </div>
                </div>

                <!-- Footer / Pool -->
                <div class="flex justify-between items-center border-t border-white/5 pt-3">
                    <div>
                        <p class="text-[10px] text-gray-400 uppercase">Pool Size</p>
                        <p class="text-sm font-bold text-gradient-money">₦${pool.toLocaleString()}</p>
                    </div>
                    <button onclick="openModal('${h.name}', '${a.name}', ${pool})" 
                        class="px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wide transition-transform active:scale-95
                        ${currentTab === 'past' ? 'bg-gray-700 text-gray-400 cursor-not-allowed' : 'bg-brand-gold text-gray-900 shadow-lg shadow-yellow-500/20'}">
                        ${currentTab === 'past' ? 'Results' : 'Predict'}
                    </button>
                </div>
            `;
            return div;
        }

        function openModal(home, away, pool) {
            if(currentTab === 'past') return;
            
            const content = document.getElementById('modal-content');
            const modal = document.getElementById('match-modal');
            
            content.innerHTML = `
                <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Match Prediction</p>
                <h2 class="text-xl font-bold text-white mb-1">${home} <span class="text-gray-500">vs</span> ${away}</h2>
                <div class="bg-gray-900/50 rounded-lg p-2 mb-6 inline-block">
                    <p class="text-yellow-500 font-bold text-lg">Pool: ₦${pool.toLocaleString()}</p>
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-3 gap-3">
                        <button class="bg-gray-700 hover:bg-green-600 text-white p-3 rounded-lg font-bold transition-colors border border-white/5 group">
                            <span class="block text-xs text-gray-400 group-hover:text-white mb-1">HOME</span>
                            1
                        </button>
                        <button class="bg-gray-700 hover:bg-gray-500 text-white p-3 rounded-lg font-bold transition-colors border border-white/5 group">
                            <span class="block text-xs text-gray-400 group-hover:text-white mb-1">DRAW</span>
                            X
                        </button>
                        <button class="bg-gray-700 hover:bg-red-600 text-white p-3 rounded-lg font-bold transition-colors border border-white/5 group">
                            <span class="block text-xs text-gray-400 group-hover:text-white mb-1">AWAY</span>
                            2
                        </button>
                    </div>
                    
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-400">₦</span>
                        <input type="number" placeholder="Stake Amount" class="w-full bg-black/30 text-white p-3 pl-8 rounded-lg border border-gray-600 focus:border-brand-gold outline-none transition-colors">
                    </div>
                    
                    <button class="w-full bg-brand-green text-white font-bold py-3 rounded-lg shadow-lg hover:bg-green-600 transition-colors" onclick="alert('Ticket confirmed! Good luck.')">
                        Place Bet
                    </button>
                </div>
            `;
            modal.classList.remove('hidden');
        }
    </script>
</body>
</html>

