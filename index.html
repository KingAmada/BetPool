<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BetPool - Nigeria's Premier Pool Betting</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'display': ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        'brand-dark': '#0F172A',
                        'brand-card': '#1E293B',
                        'brand-green': '#008753', // Nigerian Green
                        'brand-gold': '#F59E0B',
                        'brand-accent': '#10B981', 
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #0F172A;
            color: #F8FAFC;
            -webkit-tap-highlight-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0F172A; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .glass-heavy {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Toast Notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: rgba(30, 41, 59, 0.95);
            border-left: 4px solid #008753;
            color: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideDown 0.3s ease-out;
            font-size: 14px;
            font-weight: 500;
        }
        
        .toast.error { border-left-color: #EF4444; }
        .toast.success { border-left-color: #10B981; }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Page Transitions */
        .page-section {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .page-section.active { display: block; }

        /* Loaders */
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-left-color: #F59E0B;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Navigation Active State */
        .nav-item.active svg { color: #F59E0B; }
        .nav-item.active span { color: #F59E0B; }

    </style>
</head>
<body class="pb-20">

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Header -->
    <header class="glass fixed top-0 w-full z-40 px-4 py-3 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-2" onclick="navTo('home')">
            <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-700 rounded-lg flex items-center justify-center text-white font-bold shadow-lg cursor-pointer">
                BP
            </div>
            <h1 class="text-xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400 cursor-pointer">BetPool</h1>
        </div>
        
        <div class="flex items-center gap-3">
            <!-- Balance (Hidden if not logged in) -->
            <div id="header-balance-card" class="hidden bg-brand-dark/50 px-3 py-1.5 rounded-full border border-green-500/30 flex items-center gap-2">
                <span class="text-xs text-gray-400">BAL:</span>
                <span id="header-balance" class="text-sm font-bold text-brand-gold">â‚¦0</span>
            </div>

            <!-- Auth Buttons -->
            <div id="header-auth" class="flex gap-2">
                <button onclick="openModal('login-modal')" class="text-sm font-medium text-gray-300 hover:text-white">Login</button>
                <button onclick="openModal('signup-modal')" class="bg-brand-green hover:bg-green-600 text-white text-xs font-bold px-3 py-1.5 rounded-md transition-colors shadow-lg shadow-green-900/20">
                    Join
                </button>
            </div>
            
            <!-- User Profile Icon (Hidden if not logged in) -->
            <div id="header-user" class="hidden cursor-pointer" onclick="navTo('profile')">
                <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center border border-gray-500">
                    <svg class="w-4 h-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="pt-20 container mx-auto px-4 min-h-screen">

        <!-- HOME PAGE -->
        <section id="page-home" class="page-section active">
            <!-- Hero -->
            <div class="relative rounded-2xl overflow-hidden bg-gradient-to-r from-brand-card to-brand-dark border border-white/5 shadow-2xl mb-8">
                <div class="absolute top-0 right-0 w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                <div class="relative z-10 p-6 md:p-10 text-center md:text-left flex flex-col md:flex-row items-center justify-between">
                    <div class="md:w-2/3">
                        <span class="inline-block py-1 px-3 rounded-full bg-yellow-500/10 text-yellow-500 text-xs font-bold mb-3 border border-yellow-500/20">ðŸ‡³ðŸ‡¬ #1 Pool Betting Platform</span>
                        <h2 class="text-3xl md:text-5xl font-display font-extrabold leading-tight mb-4">
                            Don't Just Watch.<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-brand-gold">Win Together.</span>
                        </h2>
                        <p class="text-gray-400 mb-6 text-sm md:text-base max-w-lg">Join thousands of Nigerians sharing massive cash pools. Instant payouts, zero house edge, pure excitement.</p>
                        <button onclick="navTo('matches')" class="bg-brand-green hover:bg-green-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-green-500/20 transition-all transform active:scale-95">
                            Start Winning Today
                        </button>
                    </div>
                    <div class="mt-6 md:mt-0 w-full md:w-1/3 flex justify-center">
                        <!-- Animated Floating Card -->
                        <div class="bg-brand-card border border-white/10 p-4 rounded-xl shadow-2xl animate-pulse-slow w-64">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-xs text-gray-400">Current Jackpot</div>
                                <div class="text-xs text-red-500 font-bold">LIVE</div>
                            </div>
                            <div class="text-2xl font-display font-black text-white mb-1">â‚¦8,450,200</div>
                            <div class="h-1 w-full bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-400 to-yellow-400 w-[75%]"></div>
                            </div>
                            <div class="mt-2 text-[10px] text-gray-400 text-right">1,234 Players Joined</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-3 mb-8">
                <div class="bg-brand-card p-3 rounded-xl border border-white/5 text-center">
                    <div class="text-brand-gold font-bold text-lg">15k+</div>
                    <div class="text-[10px] text-gray-400 uppercase">Winners</div>
                </div>
                <div class="bg-brand-card p-3 rounded-xl border border-white/5 text-center">
                    <div class="text-green-400 font-bold text-lg">â‚¦45M</div>
                    <div class="text-[10px] text-gray-400 uppercase">Paid Out</div>
                </div>
                <div class="bg-brand-card p-3 rounded-xl border border-white/5 text-center">
                    <div class="text-blue-400 font-bold text-lg">24/7</div>
                    <div class="text-[10px] text-gray-400 uppercase">Support</div>
                </div>
            </div>

            <!-- Hot Matches Preview -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-display font-bold text-lg">Trending Pools ðŸ”¥</h3>
                <button onclick="navTo('matches')" class="text-xs text-brand-gold hover:underline">View All</button>
            </div>
            
            <div id="home-featured-matches" class="space-y-3">
                <!-- Content populated by JS -->
                <div class="flex justify-center py-4"><div class="spinner"></div></div>
            </div>
        </section>

        <!-- MATCHES PAGE -->
        <section id="page-matches" class="page-section">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-display font-bold">Available Pools</h2>
                <div class="bg-brand-card p-1 rounded-lg flex">
                    <button onclick="filterMatches('live')" id="filter-live" class="px-3 py-1 text-xs font-bold rounded-md bg-brand-card text-gray-400 transition-all">LIVE</button>
                    <button onclick="filterMatches('upcoming')" id="filter-upcoming" class="px-3 py-1 text-xs font-bold rounded-md bg-brand-green text-white shadow transition-all">UPCOMING</button>
                </div>
            </div>

            <div id="matches-container" class="space-y-4 pb-10">
                <div class="text-center py-20">
                    <div class="spinner mx-auto mb-4"></div>
                    <p class="text-gray-400 text-sm">Loading fixtures...</p>
                </div>
            </div>
        </section>

        <!-- PROFILE PAGE -->
        <section id="page-profile" class="page-section">
            <!-- Not Logged In State -->
            <div id="profile-guest" class="text-center py-20 hidden">
                <div class="w-20 h-20 bg-brand-card rounded-full flex items-center justify-center mx-auto mb-4 border border-white/10">
                    <svg class="w-10 h-10 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                </div>
                <h2 class="text-xl font-bold mb-2">Access Your Dashboard</h2>
                <p class="text-gray-400 text-sm mb-6 max-w-xs mx-auto">Log in to view your wallet balance, bet history, and withdraw winnings.</p>
                <button onclick="openModal('login-modal')" class="bg-brand-gold text-black font-bold py-3 px-8 rounded-xl">Login Now</button>
            </div>

            <!-- Logged In State -->
            <div id="profile-user" class="hidden">
                <!-- User Header -->
                <div class="flex items-center gap-4 mb-8">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-xl font-bold text-white shadow-lg">
                        <span id="profile-initials">UN</span>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold" id="profile-name">User Name</h2>
                        <p class="text-sm text-gray-400" id="profile-phone">+234 ...</p>
                    </div>
                </div>

                <!-- Wallet Card -->
                <div class="bg-gradient-to-br from-green-900 to-gray-900 p-6 rounded-2xl border border-green-500/30 shadow-xl mb-8 relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 w-40 h-40 bg-green-500/20 rounded-full blur-3xl"></div>
                    <p class="text-gray-400 text-sm font-medium mb-1">Available Balance</p>
                    <h3 class="text-3xl font-display font-black text-white mb-6 tracking-tight" id="profile-balance-display">â‚¦0.00</h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="openModal('deposit-modal')" class="bg-white text-green-900 font-bold py-2.5 rounded-lg text-sm hover:bg-gray-100 transition-colors">
                            Deposit
                        </button>
                        <button onclick="openModal('withdraw-modal')" class="bg-black/40 text-white border border-white/10 font-bold py-2.5 rounded-lg text-sm hover:bg-black/60 transition-colors">
                            Withdraw
                        </button>
                    </div>
                </div>

                <!-- Bet History -->
                <h3 class="font-bold text-lg mb-4 border-b border-gray-800 pb-2">Betting History</h3>
                <div id="bet-history-container" class="space-y-3">
                    <p class="text-gray-500 text-sm italic">No bets placed yet.</p>
                </div>
                
                <button onclick="doLogout()" class="mt-8 w-full py-3 text-red-500 font-bold text-sm bg-red-500/10 rounded-xl hover:bg-red-500/20">
                    Log Out
                </button>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="glass-heavy fixed bottom-0 w-full z-50 pb-safe">
        <div class="flex justify-around items-center h-16">
            <div onclick="navTo('home')" class="nav-item active flex flex-col items-center justify-center w-full h-full cursor-pointer group">
                <svg class="w-6 h-6 text-gray-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span class="text-[10px] font-medium text-gray-500 mt-1">Home</span>
            </div>
            <div onclick="navTo('matches')" class="nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer group">
                <svg class="w-6 h-6 text-gray-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <span class="text-[10px] font-medium text-gray-500 mt-1">Matches</span>
            </div>
            <div onclick="navTo('profile')" class="nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer group">
                <svg class="w-6 h-6 text-gray-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span class="text-[10px] font-medium text-gray-500 mt-1">Profile</span>
            </div>
        </div>
    </nav>

    <!-- MODALS -->
    <!-- Modal Backdrop -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden transition-opacity opacity-0" onclick="closeAllModals()"></div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-sm bg-brand-card border border-white/10 rounded-2xl p-6 z-[70] hidden shadow-2xl transform scale-95 transition-all">
        <h3 class="text-xl font-bold text-white mb-4 text-center">Welcome Back</h3>
        <form onsubmit="handleLogin(event)">
            <div class="mb-4">
                <label class="block text-xs text-gray-400 mb-1">Phone Number</label>
                <input type="tel" id="login-phone" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white focus:border-brand-gold focus:outline-none transition-colors" placeholder="08012345678" required>
            </div>
            <div class="mb-6">
                <label class="block text-xs text-gray-400 mb-1">Password</label>
                <input type="password" id="login-pass" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white focus:border-brand-gold focus:outline-none transition-colors" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" required>
            </div>
            <button type="submit" class="w-full bg-brand-gold hover:bg-yellow-500 text-black font-bold py-3 rounded-lg transition-colors">Log In</button>
            <p class="text-center text-xs text-gray-500 mt-4">Don't have an account? <span onclick="closeAllModals(); openModal('signup-modal')" class="text-brand-gold cursor-pointer hover:underline">Sign Up</span></p>
        </form>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-sm bg-brand-card border border-white/10 rounded-2xl p-6 z-[70] hidden shadow-2xl">
        <h3 class="text-xl font-bold text-white mb-4 text-center">Create Account</h3>
        <form onsubmit="handleSignup(event)">
            <div class="mb-3">
                <label class="block text-xs text-gray-400 mb-1">Full Name</label>
                <input type="text" id="signup-name" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white focus:border-brand-green focus:outline-none" required>
            </div>
            <div class="mb-3">
                <label class="block text-xs text-gray-400 mb-1">Phone Number</label>
                <input type="tel" id="signup-phone" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white focus:border-brand-green focus:outline-none" required>
            </div>
            <div class="mb-4">
                <label class="block text-xs text-gray-400 mb-1">Password</label>
                <input type="password" id="signup-pass" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white focus:border-brand-green focus:outline-none" required>
            </div>
            <button type="submit" class="w-full bg-brand-green hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors">Create Account</button>
        </form>
    </div>

    <!-- Bet Modal -->
    <div id="bet-modal" class="fixed bottom-0 left-0 w-full bg-brand-card border-t border-white/10 rounded-t-3xl p-6 z-[70] transform translate-y-full transition-transform duration-300">
        <div class="w-12 h-1 bg-gray-700 rounded-full mx-auto mb-6"></div>
        
        <div id="bet-modal-content">
            <!-- Content injected via JS -->
        </div>
    </div>

    <!-- Deposit/Withdraw Modals (Generic Template) -->
    <div id="transaction-modal" class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-xs bg-brand-card border border-white/10 rounded-2xl p-6 z-[70] hidden">
        <h3 id="trans-title" class="text-lg font-bold text-white mb-4">Transaction</h3>
        <input type="number" id="trans-amount" class="w-full bg-brand-dark border border-gray-700 rounded-lg p-3 text-white mb-4 text-center text-xl font-bold" placeholder="â‚¦0.00">
        <div class="grid grid-cols-2 gap-3">
            <button onclick="closeAllModals()" class="bg-gray-700 text-white py-2 rounded-lg text-sm">Cancel</button>
            <button id="trans-confirm-btn" class="bg-brand-gold text-black py-2 rounded-lg font-bold text-sm">Confirm</button>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- State Management ---
        const App = {
            currentUser: null,
            matches: [],
            currentFilter: 'upcoming',
            apiUrl: 'https://v3.football.api-sports.io/fixtures',
            apiKey: '0324b629847195253f0d59397c5b3df4', // Public key for demo
            timezone: 'Africa/Lagos'
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            fetchMatches();
            setupUI();
        });

        function setupUI() {
            // Close modals on backdrop click is handled inline
            // Setup filter buttons logic
        }

        // --- Toast Notification System ---
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 text-white/50 hover:text-white">&times;</button>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // --- Navigation System ---
        function navTo(pageId) {
            // Update Navigation UI
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[onclick="navTo('${pageId}')"]`);
            if(activeNav) activeNav.classList.add('active');

            // Transition Pages
            document.querySelectorAll('.page-section').forEach(el => {
                el.classList.remove('active');
            });
            const target = document.getElementById(`page-${pageId}`);
            if(target) target.classList.add('active');
            
            window.scrollTo(0,0);

            if(pageId === 'profile') updateProfileUI();
        }

        // --- Authentication Logic ---
        function checkAuth() {
            const user = localStorage.getItem('betpool_user');
            if(user) {
                App.currentUser = JSON.parse(user);
                updateAuthUI(true);
            } else {
                updateAuthUI(false);
            }
        }

        function updateAuthUI(isLoggedIn) {
            const headerAuth = document.getElementById('header-auth');
            const headerUser = document.getElementById('header-user');
            const headerBalCard = document.getElementById('header-balance-card');
            
            const profileGuest = document.getElementById('profile-guest');
            const profileUser = document.getElementById('profile-user');

            if(isLoggedIn) {
                headerAuth.classList.add('hidden');
                headerUser.classList.remove('hidden');
                headerBalCard.classList.remove('hidden');
                document.getElementById('header-balance').textContent = `â‚¦${App.currentUser.balance.toLocaleString()}`;
                
                profileGuest.classList.add('hidden');
                profileUser.classList.remove('hidden');
                
                updateProfileUI();
            } else {
                headerAuth.classList.remove('hidden');
                headerUser.classList.add('hidden');
                headerBalCard.classList.add('hidden');
                
                profileGuest.classList.remove('hidden');
                profileUser.classList.add('hidden');
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const phone = document.getElementById('signup-phone').value;
            const pass = document.getElementById('signup-pass').value;

            if(pass.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }

            const newUser = {
                name, phone, pass,
                balance: 500, // Sign up bonus
                bets: []
            };

            // In real app, this checks backend. Here we mock.
            localStorage.setItem('betpool_user', JSON.stringify(newUser));
            App.currentUser = newUser;
            
            closeAllModals();
            showToast('Account created! You got â‚¦500 bonus.');
            updateAuthUI(true);
        }

        function handleLogin(e) {
            e.preventDefault();
            // For prototype, we accept any input that "looks" right or check prev localstorage
            const phone = document.getElementById('login-phone').value;
            const stored = JSON.parse(localStorage.getItem('betpool_user'));

            if(stored && stored.phone === phone) {
                App.currentUser = stored;
                localStorage.setItem('betpool_user', JSON.stringify(stored)); // Refresh session
                closeAllModals();
                showToast('Welcome back, ' + stored.name.split(' ')[0]);
                updateAuthUI(true);
            } else {
                // Allow generic login for demo purposes if no account found
                const demoUser = { name: 'Demo User', phone: phone, balance: 1000, bets: [] };
                localStorage.setItem('betpool_user', JSON.stringify(demoUser));
                App.currentUser = demoUser;
                closeAllModals();
                showToast('Logged in as Demo User');
                updateAuthUI(true);
            }
        }

        function doLogout() {
            localStorage.removeItem('betpool_user');
            App.currentUser = null;
            updateAuthUI(false);
            showToast('Logged out successfully');
            navTo('home');
        }

        function updateProfileUI() {
            if(!App.currentUser) return;
            
            document.getElementById('profile-name').textContent = App.currentUser.name;
            document.getElementById('profile-phone').textContent = App.currentUser.phone;
            document.getElementById('profile-balance-display').textContent = `â‚¦${App.currentUser.balance.toLocaleString()}`;
            
            // Initials
            const names = App.currentUser.name.split(' ');
            const initials = (names[0][0] + (names[1] ? names[1][0] : '')).toUpperCase();
            document.getElementById('profile-initials').textContent = initials;

            // Bet History
            const historyContainer = document.getElementById('bet-history-container');
            if(App.currentUser.bets && App.currentUser.bets.length > 0) {
                historyContainer.innerHTML = '';
                [...App.currentUser.bets].reverse().forEach(bet => {
                    const card = document.createElement('div');
                    card.className = 'bg-brand-card border border-white/5 p-3 rounded-lg flex justify-between items-center';
                    card.innerHTML = `
                        <div>
                            <div class="text-xs text-gray-400">${bet.date}</div>
                            <div class="font-bold text-sm">${bet.match}</div>
                            <div class="text-xs text-brand-gold">Pick: ${bet.pick}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-sm">â‚¦${bet.amount}</div>
                            <div class="text-[10px] text-gray-400">Pending</div>
                        </div>
                    `;
                    historyContainer.appendChild(card);
                });
            } else {
                historyContainer.innerHTML = '<p class="text-center text-gray-500 text-sm py-4">No bets placed yet. Start winning!</p>';
            }
        }

        // --- Data Fetching (Robust with Fallback) ---
        async function fetchMatches() {
            try {
                // Fetch Upcoming
                const res = await fetch(`${App.apiUrl}?next=20&timezone=${App.timezone}`, {
                    headers: { "x-apisports-key": App.apiKey }
                });
                
                // Fetch Live
                const liveRes = await fetch(`${App.apiUrl}?live=all&timezone=${App.timezone}`, {
                    headers: { "x-apisports-key": App.apiKey }
                });

                if (!res.ok || !liveRes.ok) throw new Error('API Limit');

                const data = await res.json();
                const liveData = await liveRes.json();

                App.matches = [...(liveData.response || []), ...(data.response || [])];

                if(App.matches.length === 0) throw new Error('No data');
                
                renderMatches();

            } catch (err) {
                console.log("Using Mock Data due to API limit/error");
                generateMockData();
                renderMatches();
            }
        }

        function generateMockData() {
            // Robust Mock Data Generator
            App.matches = [
                {
                    fixture: { id: 1, status: { short: 'LIVE', elapsed: 45 }, date: new Date().toISOString() },
                    teams: { home: { name: 'Chelsea' }, away: { name: 'Arsenal' } },
                    league: { name: 'Premier League' },
                    goals: { home: 1, away: 1 }
                },
                {
                    fixture: { id: 2, status: { short: 'NS' }, date: new Date(Date.now() + 3600000).toISOString() },
                    teams: { home: 'Real Madrid' }, away: { name: 'Barcelona' },
                    league: { name: 'La Liga' },
                    goals: { home: null, away: null }
                },
                {
                    fixture: { id: 3, status: { short: 'NS' }, date: new Date(Date.now() + 7200000).toISOString() },
                    teams: { home: 'Enyimba FC' }, away: { name: 'Kano Pillars' },
                    league: { name: 'NPFL' },
                    goals: { home: null, away: null }
                },
                 {
                    fixture: { id: 4, status: { short: 'LIVE', elapsed: 88 }, date: new Date().toISOString() },
                    teams: { home: 'Man City' }, away: { name: 'Liverpool' },
                    league: { name: 'Premier League' },
                    goals: { home: 2, away: 3 }
                }
            ];
        }

        function renderMatches() {
            const container = document.getElementById('matches-container');
            const featured = document.getElementById('home-featured-matches');
            container.innerHTML = '';
            featured.innerHTML = '';

            let filtered = App.matches;
            
            // Handle Filter Logic
            const filterLiveBtn = document.getElementById('filter-live');
            const filterUpBtn = document.getElementById('filter-upcoming');
            
            if(App.currentFilter === 'live') {
                filtered = App.matches.filter(m => ['LIVE', '1H', '2H', 'HT'].includes(m.fixture.status.short));
                filterLiveBtn.className = "px-3 py-1 text-xs font-bold rounded-md bg-brand-green text-white shadow transition-all";
                filterUpBtn.className = "px-3 py-1 text-xs font-bold rounded-md bg-brand-card text-gray-400 transition-all";
            } else {
                filtered = App.matches.filter(m => !['LIVE', '1H', '2H', 'HT', 'FT'].includes(m.fixture.status.short));
                 filterLiveBtn.className = "px-3 py-1 text-xs font-bold rounded-md bg-brand-card text-gray-400 transition-all";
                filterUpBtn.className = "px-3 py-1 text-xs font-bold rounded-md bg-brand-green text-white shadow transition-all";
            }

            // If empty
            if(filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-gray-500">No ${App.currentFilter} matches found.</div>`;
            }

            filtered.forEach(match => {
                const card = createMatchCard(match);
                container.appendChild(card);
            });

            // Populate Home Featured (Mix of top 3)
            App.matches.slice(0, 3).forEach(match => {
                const card = createMatchCard(match, true);
                featured.appendChild(card);
            });
        }

        function createMatchCard(match, isMini = false) {
            const isLive = ['LIVE', '1H', '2H', 'HT'].includes(match.fixture.status.short);
            const poolSize = Math.floor(Math.random() * 5000000) + 500000;
            
            const div = document.createElement('div');
            div.className = 'bg-brand-card border border-white/5 rounded-xl p-4 relative overflow-hidden group active:scale-[0.98] transition-transform';
            
            const statusBadge = isLive 
                ? `<span class="text-red-500 font-bold animate-pulse">LIVE ${match.fixture.status.elapsed}'</span>`
                : `<span class="text-gray-400 font-mono text-xs">${new Date(match.fixture.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
            
            const scoreDisplay = isLive
                ? `<span class="text-xl font-bold text-white bg-brand-dark px-3 py-1 rounded border border-white/10">${match.goals.home} - ${match.goals.away}</span>`
                : `<span class="text-sm font-bold text-brand-gold bg-yellow-500/10 px-2 py-1 rounded">VS</span>`;

            div.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">${match.league.name}</span>
                    ${statusBadge}
                </div>
                <div class="flex items-center justify-between mb-4">
                    <div class="text-center w-1/3">
                        <div class="font-bold text-sm md:text-base text-white truncate">${match.teams.home.name}</div>
                    </div>
                    <div class="w-1/3 flex justify-center">
                        ${scoreDisplay}
                    </div>
                    <div class="text-center w-1/3">
                        <div class="font-bold text-sm md:text-base text-white truncate">${match.teams.away.name}</div>
                    </div>
                </div>
                <div class="flex items-center justify-between pt-3 border-t border-white/5">
                    <div>
                        <div class="text-[10px] text-gray-500">Pool Prize</div>
                        <div class="text-sm font-bold text-brand-gold">â‚¦${poolSize.toLocaleString()}</div>
                    </div>
                    <button onclick='openBetModal(${JSON.stringify(match).replace(/'/g, "&apos;")}, ${poolSize})' class="bg-white/5 hover:bg-brand-green hover:text-white text-gray-300 text-xs font-bold px-4 py-2 rounded-lg transition-colors">
                        ${isLive ? 'Bet Live' : 'Predict'}
                    </button>
                </div>
            `;
            return div;
        }

        function filterMatches(type) {
            App.currentFilter = type;
            renderMatches();
        }

        // --- Betting Logic ---
        function openBetModal(match, pool) {
            const modal = document.getElementById('bet-modal');
            const content = document.getElementById('bet-modal-content');
            const backdrop = document.getElementById('modal-backdrop');
            
            // Populate Modal
            content.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-white font-bold text-lg">${match.teams.home.name} vs ${match.teams.away.name}</h3>
                        <p class="text-brand-gold text-sm font-medium">Pool: â‚¦${pool.toLocaleString()}</p>
                    </div>
                    <button onclick="closeBetModal()" class="text-gray-500 hover:text-white">&times;</button>
                </div>
                
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <button onclick="selectBetOption(this, '1')" class="bet-option bg-brand-dark border border-gray-700 p-4 rounded-xl hover:border-brand-gold transition-all">
                        <div class="text-xs text-gray-400 mb-1">HOME</div>
                        <div class="font-bold text-white text-lg">1</div>
                    </button>
                    <button onclick="selectBetOption(this, 'X')" class="bet-option bg-brand-dark border border-gray-700 p-4 rounded-xl hover:border-brand-gold transition-all">
                        <div class="text-xs text-gray-400 mb-1">DRAW</div>
                        <div class="font-bold text-white text-lg">X</div>
                    </button>
                    <button onclick="selectBetOption(this, '2')" class="bet-option bg-brand-dark border border-gray-700 p-4 rounded-xl hover:border-brand-gold transition-all">
                        <div class="text-xs text-gray-400 mb-1">AWAY</div>
                        <div class="font-bold text-white text-lg">2</div>
                    </button>
                </div>

                <div class="mb-6">
                    <label class="text-xs text-gray-400 block mb-2">Stake Amount (â‚¦)</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-gray-400">â‚¦</span>
                        <input type="number" id="bet-stake" class="w-full bg-brand-dark border border-gray-700 rounded-xl py-3 pl-8 pr-4 text-white font-bold focus:border-brand-green focus:outline-none" placeholder="100">
                    </div>
                </div>

                <button onclick="placeBet('${match.teams.home.name} vs ${match.teams.away.name}')" class="w-full bg-gradient-to-r from-green-500 to-green-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-500/20 hover:shadow-green-500/40 transition-all">
                    Place Bet
                </button>
            `;

            backdrop.classList.remove('hidden');
            setTimeout(() => backdrop.classList.remove('opacity-0'), 10);
            modal.classList.remove('translate-y-full');
        }

        function closeBetModal() {
            const modal = document.getElementById('bet-modal');
            const backdrop = document.getElementById('modal-backdrop');
            modal.classList.add('translate-y-full');
            backdrop.classList.add('opacity-0');
            setTimeout(() => backdrop.classList.add('hidden'), 300);
        }

        let selectedOutcome = null;
        function selectBetOption(btn, outcome) {
            document.querySelectorAll('.bet-option').forEach(el => {
                el.classList.remove('bg-brand-gold', 'text-black');
                el.classList.add('bg-brand-dark', 'text-white');
                el.querySelector('.text-xs').classList.remove('text-black'); 
                el.querySelector('.text-xs').classList.add('text-gray-400');
            });
            
            btn.classList.remove('bg-brand-dark', 'text-white');
            btn.classList.add('bg-brand-gold', 'text-black');
            btn.querySelector('.text-xs').classList.remove('text-gray-400');
            btn.querySelector('.text-xs').classList.add('text-black');
            
            selectedOutcome = outcome;
        }

        function placeBet(matchName) {
            if(!App.currentUser) {
                closeBetModal();
                showToast('Please login to bet', 'error');
                setTimeout(() => openModal('login-modal'), 500);
                return;
            }
            
            if(!selectedOutcome) {
                showToast('Please select an outcome', 'error');
                return;
            }

            const stake = parseInt(document.getElementById('bet-stake').value);
            if(!stake || stake < 100) {
                showToast('Minimum stake is â‚¦100', 'error');
                return;
            }

            if(App.currentUser.balance < stake) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Deduct Balance
            App.currentUser.balance -= stake;
            
            // Add to history
            const newBet = {
                match: matchName,
                pick: selectedOutcome,
                amount: stake,
                date: new Date().toLocaleDateString()
            };
            App.currentUser.bets.push(newBet);
            
            localStorage.setItem('betpool_user', JSON.stringify(App.currentUser));
            
            closeBetModal();
            showToast(`Bet Placed! â‚¦${stake} deducted.`);
            updateAuthUI(true);
            
            // Reset
            selectedOutcome = null;
        }

        // --- Generic Modal Helpers ---
        function openModal(id) {
            const modal = document.getElementById(id);
            const backdrop = document.getElementById('modal-backdrop');
            
            if(id === 'deposit-modal' || id === 'withdraw-modal') {
                setupTransactionModal(id);
                return;
            }

            backdrop.classList.remove('hidden');
            setTimeout(() => backdrop.classList.remove('opacity-0'), 10);
            
            modal.classList.remove('hidden');
            // Small delay for animation
            setTimeout(() => {
                modal.classList.remove('scale-95', 'opacity-0');
                modal.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeAllModals() {
            const backdrop = document.getElementById('modal-backdrop');
            const modals = document.querySelectorAll('[id$="-modal"]'); // Select all ending in -modal
            
            backdrop.classList.add('opacity-0');
            setTimeout(() => backdrop.classList.add('hidden'), 300);

            modals.forEach(m => {
                if(m.id === 'bet-modal') {
                     m.classList.add('translate-y-full');
                } else {
                    m.classList.add('hidden');
                }
            });
        }

        function setupTransactionModal(type) {
            const modal = document.getElementById('transaction-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const title = document.getElementById('trans-title');
            const btn = document.getElementById('trans-confirm-btn');
            const input = document.getElementById('trans-amount');
            
            input.value = '';
            
            backdrop.classList.remove('hidden');
            setTimeout(() => backdrop.classList.remove('opacity-0'), 10);
            modal.classList.remove('hidden');

            if(type === 'deposit-modal') {
                title.textContent = 'Deposit Funds';
                btn.textContent = 'Pay Securely';
                btn.onclick = () => {
                    const amt = parseInt(input.value);
                    if(amt > 0) {
                        App.currentUser.balance += amt;
                        localStorage.setItem('betpool_user', JSON.stringify(App.currentUser));
                        updateAuthUI(true);
                        closeAllModals();
                        showToast(`â‚¦${amt} deposited successfully!`);
                    }
                };
            } else {
                title.textContent = 'Withdraw Funds';
                btn.textContent = 'Withdraw Now';
                btn.onclick = () => {
                    const amt = parseInt(input.value);
                    if(amt > 0 && amt <= App.currentUser.balance) {
                        App.currentUser.balance -= amt;
                        localStorage.setItem('betpool_user', JSON.stringify(App.currentUser));
                        updateAuthUI(true);
                        closeAllModals();
                        showToast(`Withdrawal of â‚¦${amt} queued.`);
                    } else {
                        showToast('Invalid amount or insufficient funds', 'error');
                    }
                };
            }
        }

    </script>
</body>
</html>
